- 커널은 중요한 자원을 관리하기 때문에 사용자가 중요한 자원에 접근하지 못하도록 2가지 모드로 나눈다.
- user mode vs kernel mode
    - user mode: 사용자가 접근할 수 있는 제한적 영역.
        - 여기서 코드를 작성하고, 프로세스 실행 등이 일어난다.
    - 커널모드: 모든 자원에 접근, 명령할 수 있음
- 흐름
    1. user→kernel mode로 전환: 유저모드에서 프로그램 실행 중 인터럽트 발생 or 시스템 콜을 호출하게 되면 커널모드로 전환
    2. kernel 모드: 프로그램의 현재 CPU 상태를 저장 후 커널이 인터럽트나 시스템 콜을 직접 처리하고 → 모든 처리가 완료되면 중단됐던 프로그램의 cpu상태를 복원함 
    3. kernel→user모드: 중단된 프로그램의 상태를 다시 이어서 시작하려고 다시 cpu상태를 복원하고 다시 통제권을 프로그램에게 반환
    4. user모드: 프로그램이 이어서 실행
    
    ![dfd](./%EC%9D%B4%EB%AF%B8%EC%A7%80/user%EB%AA%A8%EB%91%90.png)
    

---

- 인터럽트: 프로그램 실행 중 **여러 이벤트(입출력 연산, 예외사항 등**)가 발생하면 현재 실행작업을 중단하고, 우선처리가 필요함을 cpu에게 알리는 것
    - 인터럽트 종류:
        - 외내부 인터럽트: 1)전원에 문제가 생겼을 때, 2)I/O작업이 완료됐을 때, 3)시간이 다됐을 때(timer 관련) 4)0으로 나눴을 때 5)잘못된 메모리 공간에 접근을 시도할 때 등
        - 소프트웨어 인터럽트: 프로그램 처리 중 명령의 요청에 의해 발생한 것 ex)이용 중 다른 프로세스를 실행시키면 자원할당 동작이 수행됨
    - 인터럽트가 발생되면 cpu에서는 즉각적으로 인터럽트처리를 위해서 커널모드에서 커널이 처리
    
    | 외부에서 들어오는 이벤트가 발생하면, MCU(컨트롤러)가 우선순위를 판별하는 방법
    *MCU: 작은 프로세서(연산)  |
    | --- |
    | 1. 폴링방식(sw방법): 사용자가 명령어를 사용하여 이벤트를 수행하라는 신호를 받았는지 주기적으로 검사하면서 그 신호를 받았을 때 이벤트를 실행하는 방식 |
    | 2. 인터럽트 방식(hw방법): 이벤트를 수행하라는 신호를 받으면 동작을 멈추고 바로 그 이벤트를 수행하는 방식, 실시간 대응이 필요할 때 사용
    방법: CPU와 인터럽트를 요청할 수 있는 장치 사이에 버스를 직렬/병렬로 연결해서 요청장치의 번호를 CPU에게 알려서 바로 대응할 수 있도록 함
       2-1) Daisy chain(직렬): 인터럽트가 발생하는 모든 장치를 한 개의 회선에 직렬로 연결하며 우선순위가 높은 장치를 맨 앞에 위치시켜서 우선 순위에 따라 연결
       2-2) 병렬 우선순위 부여: 인터럽트가 발생하는 각 장치를 개별적인 회선으로 연결 |
    
- 시스템 콜: 프로그램이 **os커널이 제공하는 서비스를 이용**하고 싶을 때, 시스템 콜을 사용
    - 하드웨어, 시스템 관련기능은 반드시 시스템 콜을 통해서만 사용가능
    1)프로세스/스레드(생성,,,등,,) 2)파일 I/O관련 3)소켓 관련(네트워크,,) 4)장치 관련 5)프로세스 통신 관련
    - 시스템 콜이 발생하면 해당 커널코드가 커널모드에서 실행
- 프로그래밍 언어와 시스템 콜
    
    우리는 시스템 콜을 사용한 적이 없는데? ⇒ 프로그래밍 언어들이 시스템콜을 포장해서 간접적으로 사용할 수 있도록 제공한다.
  
