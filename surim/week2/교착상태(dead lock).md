데드락(교착상태)

- 2개 이상의 프로세스, 스레드가 **서로 자원을 얻지 못해서** 다음 처리를 하지못하고 **무한히 다음 자원을 기다리는 상태**
- 시스템적으로 한정된 자원을 여러 곳에서 사용하려고 할 때 발생한다.

![Untitled](./%EC%9D%B4%EB%AF%B8%EC%A7%80/%EA%B5%90%EC%B0%A9%EC%83%81%ED%83%9C.png)

- 데드락을 만드는 4가지 조건
    1. mutual exclusion상호배제: 자원을 공유해서 사용할 수 없다
        
        (like 노트북, 충전기)
        
    2. no preemption(비선점): 어떤 리소스를 쥐고 있다면 다른 프로세스가 그 리소스를 뺏어갈 수 없다
    3. hold and wait: 프로세스는 자원을 가지고 있는 상태(hold)에서 다른 프로세스가 사용하고 있는 자원을 추가로 기다린다.(wait)
    4. circular wait: 프로세스들이 순환형태로 서로의 자원을 사용하기 위해 기다린다.
- 흔히 볼 수 있는 형태는 DB의 상호거래패턴이다.
    - TABLE A과 TABLE B에서 각각 포인트를 주고받는 일이 동시에 일어났다고 할 때, 트랜잭션1(A-10) 후 lock, 트랜잭션2(B-10) 후 lock
    - 서로 접근했을 때는 서로의 트랜잭션이 점유해버려( lock이 걸려있기 때문에) 무한 대기하게 된다.
- 데드락 해결방법
    1. 데드락 예방(방지): 4가지 조건 중 하나가 충족되지 않게 시스템을 디자인
        
        →어떤 조건이 충족되지 않게 디자인 해야 할까?
        
        - mutual exclusion: 자원을 공유를 허용 →but 자원을 공유하게 되면 꼬이게 됨
        - hold and wait: 사용할 리소스를 모두 획득한 후 시작하며, 리소스를 전혀 가지지 않은 상태에서만 리소스를 요청한다. (all or not)
            - but 놀고 있는 리소스가 생기면 리소스 사용 효율이 떨어짐, 인기가 좋은 리소스가 있다면 특정 프로세스가 기아(starvation)이 됨
            
            *starvation: 특정 프로세스의 우선순위가 낮아서 원하는 자원을 계속 할당받지 못하는 상태
            
        - no preemption: 이미 자원을 내가 선점했지만, 다른 프로세스에 양보하고 대기하게 한다
            - like cpu의 thread를 잘게 쪼개서 switching하는 context switching, critical secition에서 lock 반환과 유사
            - 단점: 자원 낭비 발생
        - circular wait: 모든 자원에 순서 체계를 부여해서 오름차순으로 리소스를 요청한다.
            - 4번자원부터 획득x, 1번획득 후 4번획득하면 길을 갈 수있음
            - 4가지 방법 중 가장 많이 사용
        - 그치만, 교착상태는 필요악이기 때문에, 예방을 잘 사용하지 않기도 한다.
            - 아예 발생하지 않으면 자원을 효율적으로 사용할 수 없기 때문
            - ex)한 프로세스가 5개 자원을 얻고 동작하고 싶은데, 1개만 얻을 수 있다고 제약을 걸어놓으면 효율적으로 사용할 수 없다. 난 여러 분야의 책을 보면서 공부를 하고 싶은데, 한번에 한 책만 보게 하는 것
    2. 데드락 회피: **실행환경**에서 추가적인 정보를 활용해서 데드락이 발생할 것같은 상황을 회피한다.
        - banker algorithm: 자원 요청을 허락해줬을 때, 데드락이 발생할 가능성이 있으면, 자원을 할당해도, 안전할 때까지 계속 요청을 거절하는 알고리즘
    3. 데드락 탐지와 복구: 일단 데드락을 허용한 후, 데드락이 발생하면 복구하는 전략
        - 탐지: 탐지 알고리즘을 사용하여 대기 그래프에 순환이 발생했는지 확인하여 교착상태를 탐지한다. but 탐지 알고리즘을 자주 호출하면 오버헤드가 커지기 때문에 적절한 주기에 호출할 필요가 있다.
        - 복구방식
        1. 프로세스1개씩 종료하면서 데드락이 해결되는지 확인하는 방법(최후의 수단)
        2. 리소스의 일시적인 선점을 허용: 교착상태가 제거될 때까지, 다른 프로세스가 선점을 해버려도, 일시적으로 그 프로세스를 사용할 수 있도록 허용함
    4. 데드락 무시
        
        → unix, 윈도우 등 대부분의 운영체제에서 사용한다. 왜냐면 적은 횟수에 비해, 데드락이 해결하는 데 들이는 비용이 더 크기 때문에 이 방식을 사용
        
    
    
- 주요 질문
1. 데드락(교착 상태)가 뭔가요? 발생 조건에 대해 말해보세요.
2. 회피 기법인 은행원 알고리즘이 뭔지 설명해보세요.
3. 기아상태를 설명하는 식사하는 철학자 문제에 대해 설명해보세요.
    
    > 교착 상태 해결책
    > 
    > 1. n명이 앉을 수 있는 테이블에서 철학자를 n-1명만 앉힘
    > 2. 한 철학자가 젓가락 두개를 모두 집을 수 있는 상황에서만 젓가락 집도록 허용
    > 3. 누군가는 왼쪽 젓가락을 먼저 집지 않고 오른쪽 젓가락을 먼저 집도록 허용