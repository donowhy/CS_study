# 컨텍스트 스취칭

목표, 왜 스레드 컨텍스트 스위칭이 프로세스 컨텍스트 스위칭보다 더 빠른지 이해할 수 있다.

## 컨텍스트 스위칭 (context switching)

cpu/ core 에서 실행 중이던 프로세스/ 스레드가 다른 프로세스/ 스레드로 교체되는 것

그럼 컨텍스트는?

→ 프로세스/스레드의 상태, 즉 cpu, 메모리 등등

cpu 는 register 등등이 있음

그럼 컨텍스트 스위칭은 왜 필요한가?

→ 여러 프로세스/스레드를 동시에 실행시키기 위해서

그럼 컨텍스트 스위칭은 언제 발생하는가?

→ 주어진 time slice ( quantum)를 다 사용했거나 IO 작업을 해야하거나 다른 리소스를 기다려야 하거나 등등

예제

멀티태스킹 시스템에서 컨텍스트 스위칭

![스크린샷 2023-04-03 오후 10.08.06.png](%E1%84%8F%E1%85%A5%E1%86%AB%E1%84%90%E1%85%A6%E1%86%A8%E1%84%89%E1%85%B3%E1%84%90%E1%85%B3%20%E1%84%89%E1%85%B3%E1%84%8E%E1%85%B1%E1%84%8E%E1%85%B5%E1%86%BC%20571b1a9fd8fa44f9bb7d56c991ced88f/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2023-04-03_%25E1%2584%258B%25E1%2585%25A9%25E1%2584%2592%25E1%2585%25AE_10.08.06.png)

그럼 컨텍스트 스위칭은 누구에 의해 실행되는가? (처음부터 끝까지 수행하는 존재)

트리거 x 

→ OS 커널 : 각종 리소스를 관리/감독하는 역할

컨텍스트 스위칭은 구체적으로 어떤 과정으로 일어나는가?

→ 다른 프로세스 끼리 스위칭(process context switching)인가 같은 프로세스의 스레드들끼리 스위칭(thread context switching)읹에 따라 다르다

둘의 공통점 → 1. 커널 모드에서 실행, 2. cpu 레지스터 상태를 교체

둘의 차이점 → 1. 서로 다른 프로세스 컨텍스트 스위칭은 가상 메모리 주소 관련 처리를 추가로 수행. MMU, TLB 를 비워줘야한다.

![스크린샷 2023-04-04 오전 6.59.50.png](%E1%84%8F%E1%85%A5%E1%86%AB%E1%84%90%E1%85%A6%E1%86%A8%E1%84%89%E1%85%B3%E1%84%90%E1%85%B3%20%E1%84%89%E1%85%B3%E1%84%8E%E1%85%B1%E1%84%8E%E1%85%B5%E1%86%BC%20571b1a9fd8fa44f9bb7d56c991ced88f/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2023-04-04_%25E1%2584%258B%25E1%2585%25A9%25E1%2584%258C%25E1%2585%25A5%25E1%2586%25AB_6.59.50.png)

같은 프로세스 끼리 컨텍스트 스위칭

![스크린샷 2023-04-04 오전 7.06.00.png](%E1%84%8F%E1%85%A5%E1%86%AB%E1%84%90%E1%85%A6%E1%86%A8%E1%84%89%E1%85%B3%E1%84%90%E1%85%B3%20%E1%84%89%E1%85%B3%E1%84%8E%E1%85%B1%E1%84%8E%E1%85%B5%E1%86%BC%20571b1a9fd8fa44f9bb7d56c991ced88f/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2023-04-04_%25E1%2584%258B%25E1%2585%25A9%25E1%2584%258C%25E1%2585%25A5%25E1%2586%25AB_7.06.00.png)

저 작업을 안해주면 메모리 주소 영역이 T1 으로 잘 못 접근할 수도 있기 때문에 MMU, p2메모리 보도록 TLB 를 비워야한다

스레드 컨텍스트 스위칭이 더 빠른 이유는 ?

→ 메모리 주소 관련 처리는 하지 않기 때문ㅇ  (cpu의 생태 정보만 바꿔주면 됨)

컨텍스트 스위칭이 미치는 간접적인 영향은?

캐시 오염 , →

유저 관점에서 컨텍 스위칭

순수한 오버헤드 → 내가 수행하는 동작에 상관없는 순수한 cpu를 잡아먹는 간접비용